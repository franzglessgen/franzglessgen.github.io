
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Franz Glessgen">
      
      
        <meta name="author" content="Franz Glessgen">
      
      
        <link rel="canonical" href="https://https:/franzglessgen.github.io/VHbb/UL/EFT/reweighting/">
      
      
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.18">
    
    
      
        <title>Reweighting procedure - Open source projects</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.7e37652d.min.css">
      
      


    
    
      
    
    
      
    
    
      <link rel="stylesheet" href="../../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../../stylesheets/fonts.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#reweighting-procedure" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="Open source projects" class="md-header__button md-logo" aria-label="Open source projects" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Open source projects
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Reweighting procedure
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/franzglessgen/MyMkDocs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Franz Glessgen
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Open source projects" class="md-nav__button md-logo" aria-label="Open source projects" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Open source projects
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/franzglessgen/MyMkDocs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Franz Glessgen
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Teaching
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Teaching
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Teaching/PhiloPhysics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Philosophy of Physics
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Proton therapy
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Proton therapy
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ProtonTherapy/Overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Theory
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Theory
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ProtonTherapy/Theory/BasicPhysics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Basic physics
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Hardware
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Hardware
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Hardware/Overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Calibrations
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Calibrations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Hardware/Calibrations/SCC/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SCC
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../about_me/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    About me
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#list-of-reweighting-weights" class="md-nav__link">
    <span class="md-ellipsis">
      List of reweighting weights
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#impacted-cr" class="md-nav__link">
    <span class="md-ellipsis">
      Impacted CR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Impacted CR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2-lepton-treatment" class="md-nav__link">
    <span class="md-ellipsis">
      2-lepton treatment
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2-lepton treatment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#btag-weights" class="md-nav__link">
    <span class="md-ellipsis">
      Btag weights
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deltarbb-weights" class="md-nav__link">
    <span class="md-ellipsis">
      deltaRbb weights
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ptjj-weights" class="md-nav__link">
    <span class="md-ellipsis">
      Ptjj weights
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-lepton-treatment" class="md-nav__link">
    <span class="md-ellipsis">
      1-lepton treatment
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1-lepton treatment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#weights-for-dy-samples" class="md-nav__link">
    <span class="md-ellipsis">
      Weights for DY samples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#btag-weights_1" class="md-nav__link">
    <span class="md-ellipsis">
      Btag weights
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deltarbb-weights_1" class="md-nav__link">
    <span class="md-ellipsis">
      DeltaRbb weights
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#0-lepton-treatment" class="md-nav__link">
    <span class="md-ellipsis">
      0-lepton treatment
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="reweighting-procedure">Reweighting procedure<a class="headerlink" href="#reweighting-procedure" title="Permanent link">#</a></h1>
<p>This Section provides a full description of all Xbb-specific computation and application of reweighting weights to MC samples to account for mismodellings and hardware deficiencies.</p>
<h2 id="list-of-reweighting-weights">List of reweighting weights<a class="headerlink" href="#list-of-reweighting-weights" title="Permanent link">#</a></h2>
<p>The following weights are applied:</p>
<ul>
<li>Btag weights to account for the mismodelling in the lower than loose region of the btag score</li>
<li>DeltaRbb weights to account for the MADGRAPH mismodelling at <span class="arithmatex">\(\Delta\text{Rbb} &lt;1\)</span></li>
<li><span class="arithmatex">\(P_{t}(jj)\)</span> weights to account for the mismodelling observed at low <span class="arithmatex">\(P_{t}(jj)\)</span> values</li>
</ul>
<h2 id="impacted-cr">Impacted CR<a class="headerlink" href="#impacted-cr" title="Permanent link">#</a></h2>
<p>Here is a table summarizing the regions in which weights are applied.
It is to be read from top to bottom, weights are computed for processes in pure regions before being applied in less pure regions to extract the weights for other processes there.</p>
<table>
<thead>
<tr>
<th>Channel</th>
<th>Process</th>
<th>Btag</th>
<th>dRbb</th>
<th>Ptjj</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>DY</td>
<td>LF</td>
<td>LF + HF</td>
<td>HF + LF</td>
</tr>
<tr>
<td>Zll</td>
<td>WJ</td>
<td><span class="arithmatex">\(\times\)</span></td>
<td><span class="arithmatex">\(\times\)</span></td>
<td><span class="arithmatex">\(\times\)</span></td>
</tr>
<tr>
<td></td>
<td>ZJ</td>
<td><span class="arithmatex">\(\times\)</span></td>
<td><span class="arithmatex">\(\times\)</span></td>
<td><span class="arithmatex">\(\times\)</span></td>
</tr>
<tr>
<td></td>
<td>ttbar</td>
<td><span class="arithmatex">\(\times\)</span></td>
<td><span class="arithmatex">\(\times\)</span></td>
<td><span class="arithmatex">\(\times\)</span></td>
</tr>
<tr>
<td></td>
<td>DY</td>
<td><span class="arithmatex">\(\times\)</span></td>
<td>LF + HF</td>
<td>LF + HF</td>
</tr>
<tr>
<td>Wlv</td>
<td>WJ</td>
<td><span class="arithmatex">\(\times\)</span></td>
<td>LF +HF</td>
<td><span class="arithmatex">\(\times\)</span></td>
</tr>
<tr>
<td></td>
<td>ZJ</td>
<td><span class="arithmatex">\(\times\)</span></td>
<td><span class="arithmatex">\(\times\)</span></td>
<td><span class="arithmatex">\(\times\)</span></td>
</tr>
<tr>
<td></td>
<td>ttbar</td>
<td>ttbar (if mis)</td>
<td><span class="arithmatex">\(\times\)</span></td>
<td><span class="arithmatex">\(\times\)</span></td>
</tr>
<tr>
<td></td>
<td>DY</td>
<td><span class="arithmatex">\(\times\)</span></td>
<td>LF + HF</td>
<td><span class="arithmatex">\(\times\)</span></td>
</tr>
<tr>
<td>Zvv</td>
<td>WJ</td>
<td><span class="arithmatex">\(\times\)</span></td>
<td>LF + HF</td>
<td><span class="arithmatex">\(\times\)</span></td>
</tr>
<tr>
<td></td>
<td>ZJ</td>
<td><span class="arithmatex">\(\times\)</span></td>
<td>LF + HF</td>
<td><span class="arithmatex">\(\times\)</span></td>
</tr>
<tr>
<td></td>
<td>ttbar</td>
<td><span class="arithmatex">\(\times\)</span></td>
<td><span class="arithmatex">\(\times\)</span></td>
<td><span class="arithmatex">\(\times\)</span></td>
</tr>
</tbody>
</table>
<h3 id="2-lepton-treatment">2-lepton treatment<a class="headerlink" href="#2-lepton-treatment" title="Permanent link">#</a></h3>
<p>In the 2-lepton channel, all three types of weights are applied. </p>
<h4 id="btag-weights">Btag weights<a class="headerlink" href="#btag-weights" title="Permanent link">#</a></h4>
<p>The btag weights are applied in the ZLF only since it is the only region containing events satisfying btag &lt; loose. They are computed by taking the data/MC ratio in the 2D grid (btag1, btag0).
The Xbb steps for computing them are as follows:</p>
<ul>
<li>
<p>Run the plots for the following variable with a fine binning
 <code>plotDef:DeepJet_2D_finebinning_2lep</code>
 This is a finely binned 2D grid covering the lower than loose btag scores. The option : draw = RATIO has to be present as well as the option channelTag_for_reweight in Plot_general. A 2D plot with such options will enter the corresponding code in NewStackMaker. It will then remove all contributions that are not Z + light jets events from the data histogram and compute the ratio to MC Z + light.</p>
</li>
<li>
<p>The previous plot is good for visualization, but the binning that was chosen for reweighting is the following: </p>
</li>
</ul>
<pre><code>[-0.01, 0.01, 0.02333, LTL] 
</code></pre>
<p>were LTL is the lower than loose boundary for the given year. The same binning is used for the low/med and high regions to have a good control on shape effects.</p>
<ul>
<li>The 2D plot with the previous binning has to be ran in 6 ZLF regions: Zee_low, Zee_med and Zee_high, Zmm_low, ...  </li>
</ul>
<pre><code>plotDef:DeepJet_2D_low_2lep
</code></pre>
<ul>
<li>The logs will contain the central values and uncertainties of the btag weights.</li>
<li>Copy those into the script: myutils/BTagWeightsDYltlooseWP (for 2lep) for each year and split in region</li>
<li>Run the module Compute_btag_2D_2lep, it will fill branches with the btag weights (only for DY in Zll)</li>
</ul>
<pre><code>./submit.py -T Zll2018 -F weight_btag2D -J sysnew --addCollections Sys.Compute_btag_2D_2lep --input WEIGHTin --output WEIGHTout --queue veryshort.q
</code></pre>
<ul>
<li>Apply the weights, rerun the caching/plotting to check closure in the btag weight 2D map and to check differences in other plots.</li>
</ul>
<h4 id="deltarbb-weights">deltaRbb weights<a class="headerlink" href="#deltarbb-weights" title="Permanent link">#</a></h4>
<ul>
<li>
<p>Those weights have to be applied after the btag ones. The Xbb steps for computing them are as follows:</p>
</li>
<li>
<p>Runplots on deltaRbb with FSR recovery in ZLF (inclusive in pT, split in ee and mm). The plot def is the following </p>
</li>
</ul>
<pre><code>plotDef:deltaRbbWithFSR_UL_LF
</code></pre>
<ul>
<li>
<p>The binning is defined by 3 bins from 0.4 to 1.0.</p>
</li>
<li>
<p>IMPORTANT: the overall normalization may be different between ZLF and ZHF. To compute it, the plot has an additional bin between 1.0 and 1.3. This bin has a large number of events and is in an orthogonal region to the low dijet pt region (see next section). The weights obtained in the &lt;1.0 bins have to be divided by the weight computed in the bin [1.0, 1.3]. This way, the overall normalization does not play a role. </p>
</li>
<li>
<p>Get the central values and uncertainties for those 2 regions by adding the options draw = RATIO and draw_region = LF in the plot def</p>
</li>
<li>Copy the SF and uncertainties to the DeltaRbb module</li>
</ul>
<pre><code>NLORbblt1Weights_2lep.py
</code></pre>
<ul>
<li>Run the module to apply those (in ZLF and ZHF)</li>
</ul>
<pre><code>./submit.py -T Zll2018 -F weight_deltaRbb -J sysnew --addCollections Sys.Compute_deltaRbb_2lep --input WEIGHTin --output WEIGHTout --queue veryshort.q
</code></pre>
<h4 id="ptjj-weights">Ptjj weights<a class="headerlink" href="#ptjj-weights" title="Permanent link">#</a></h4>
<p>After having applied the btag and deltaRbb weights, the pt(jj) has to be corrected at low values. The weights are computed in the ZLF region and then applied to ZLF and ZHF. The steps are as follows:</p>
<ul>
<li>Runplot for the variable in the ZLF region </li>
</ul>
<pre><code>Hpt_weights_low 
</code></pre>
<p>with the binning:</p>
<pre><code>[0,25.0,50.0,75.0,100.0,200.0]
</code></pre>
<p>The correction is differential in pt and in lepton flavour (6 regions). Do not forget the options draw = RATIO and draw_region = LF in the plot def.</p>
<ul>
<li>
<p>Copy the central values and uncertainties in the module PtjjWeights.py</p>
</li>
<li>
<p>Divide the central values by the overall normalization given by the last bin [100.0, 200.0]. IMPORTANT: only correct the dijet pt up to 100 GeV. The last bin is for computing this normalization so that it does not bias the application to HF.</p>
</li>
<li>
<p>Run the module </p>
</li>
</ul>
<pre><code>./submit.py -T Zll2018 -F Add_ptjj_weights -J sysnew --addCollections Sys.Compute_ptjj_2lep --input WEIGHT_pt_jj_in --output WEIGHT_pt_jj_out -i
</code></pre>
<h3 id="1-lepton-treatment">1-lepton treatment<a class="headerlink" href="#1-lepton-treatment" title="Permanent link">#</a></h3>
<p>The 1-lepton channel is more invested since both the DY and the WJ contributions need to be corrected.</p>
<h4 id="weights-for-dy-samples">Weights for DY samples<a class="headerlink" href="#weights-for-dy-samples" title="Permanent link">#</a></h4>
<p>The scale factors for DY samples have been computed in the regions of high Z+Jets purity. The same SF can thus be used in the Wlv channel. The btag weights were computed for both jets in the lower than loose region so this does not apply. Thus, only the ptjj and deltaRbb weights for DY samples are applied.
Copy the weights from the previous modules into the PtjjAndDeltaRbbWeights module and use the following command:</p>
<pre><code>./submit.py -T Wlv2018 -F Ptjj_deltaRbb_DY -J sysnew --addCollections Sys.Compute_ptjj_and_deltaRbb_DY_1lep --input DY_weights_in --output DY_weights_out --queue veryshort.q
</code></pre>
<p>You then need to recache the plots in the TT region for the next step</p>
<h4 id="btag-weights_1">Btag weights<a class="headerlink" href="#btag-weights_1" title="Permanent link">#</a></h4>
<p>Btag weights still need to be applied in the WLF and TT CR because there is no btag score cut on the  subleading jet in these regions. Thus, the events in the lower than loose region need to be reweighted to account for the btag mismodelling there. 
We chose to not apply the weights in the WLF region because the two bins to be corrected represent the largest part of the events. An overall normalization cannot be computed precisely because of this. Only apply the btag weight to TT</p>
<p>To compute the SF, do the same in for the 2 lepton channel meaning: 
 - define a binning in btag score in the lower than loose region for the subleading jet
 - add the options draw = RATIO and draw_region = TT 
 - run the plots in the TT region (split in e/m and pt med/high)
 - copy the SF to the BTagWeights_WJ_TT_ltlooseWP script
 - Divide them by the overall normalization
 - run the script using the following command</p>
<pre><code>./submit.py -T Wlv2018 -F btag_WJ_TT -J sysnew --addCollections Sys.Compute_btag_weights_WJ_TT_1lep --input Btag_weights_WJ_TT_in --output Btag_weights_WJ_TT_out --queue veryshort.q
</code></pre>
<ul>
<li>For 2018, the ttbar was well modelled so these weights were skipped altogether. </li>
<li>Fill the dictionary of WLF jets with 1.0 so that those weights are not used.</li>
</ul>
<p>You then need to recache the plots in the region WLF for the next step</p>
<h4 id="deltarbb-weights_1">DeltaRbb weights<a class="headerlink" href="#deltarbb-weights_1" title="Permanent link">#</a></h4>
<p>The deltaRbb weights are computed in WLF and applied to W+Jets in WLF and WHF. The steps are the same as for the btag weights, but the variable to be plotted is deltaRbb (split in 3 bins) in the region [0,1]. Do not forget to get the overall normalization in the region [1.0,5.0] and divide the central values and uncertainties by it.</p>
<p>Copy the optained weights in NLORbblt1Weights_1lep (inclusive in pt and split in Wenu and Wmunu) and run the command to apply them:</p>
<pre><code>./submit.py -T Wlv2018 -F deltaRbb_WJ -J sysnew --addCollections Sys.Compute_deltaRbb_weights_1lep --input DeltaRbb_weights_WJ_in --output DeltaRbb_weights_WJ_out --queue veryshort.q
</code></pre>
<p>You then need to recache the plots in the WLF for the next step</p>
<h3 id="0-lepton-treatment">0-lepton treatment<a class="headerlink" href="#0-lepton-treatment" title="Permanent link">#</a></h3>
<p>For the 0-lep channel, simply apply the DeltaRbb weights. They are applied inclusively for all V+Jets samples (split in pt bins med/high). 
There is an important difference in this channel because the overall MC normalization can be off. This overall normalization will be different in LF and HF so that the following steps need to be taken:</p>
<ul>
<li>Runplots on the deltaRbb variable with an additional bin from 1.0 to 4.0</li>
<li>This last bin will give you the overall normalization of the LF</li>
<li>The weights need to be divided by the overall normalization in LF but NOT in HF</li>
<li>The relevant argument is self.overallNormalization_LF </li>
</ul>
<p>Then, run the corresponding module (NLORbblt1Weights_0lep) like that:</p>
<pre><code>./submit.py -T Zvv2018 -F deltaRbb_VJets-v3 -J sysnew --addCollections Sys.Compute_deltaRbb_weights_0lep --input DeltaRbb_weights_in --output DeltaRbb_weights_out --queue veryshort.q
</code></pre>
<h2 id="summary">Summary<a class="headerlink" href="#summary" title="Permanent link">#</a></h2>
<p>Here are all the steps for the full reweighting of a single year:</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../../..", "features": [], "search": "../../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
        <script src="../../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>